<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Choose Account - Kudirat Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Theme Variables */
:root {
  --bg-primary: #0e0e0e;
  --bg-secondary: #1e1e1e;
  --bg-card: #1e1e1e;
  --text-primary: #ffffff;
  --text-secondary: #bbbbbb;
  --text-muted: #999999;
  --accent: #00ffae;
  --accent-secondary: #00b86b;
  --border: #333333;
  --input-bg: #1e1e1e;
  --shadow: rgba(0, 0, 0, 0.5);
}

/* Light Mode */
body.light {
  --bg-primary: #ffffff;
  --bg-secondary: #f5f5f5;
  --bg-card: #ffffff;
  --text-primary: #000000;
  --text-secondary: #666666;
  --text-muted: #999999;
  --accent: #00b86b;
  --accent-secondary: #00b86b;
  --border: #e0e0e0;
  --input-bg: #f0f0f0;
  --shadow: rgba(0, 0, 0, 0.1);
}

    * { 
      box-sizing: border-box; 
    }
    
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 20px;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    
    .logo img { 
      width: 140px; 
      margin-top: 40px; 
      margin-bottom: 30px; 
    }
    
    h2 { 
      margin: 10px 0 25px; 
      font-weight: normal;
      color: var(--text-primary);
    }
    
    .input-box {
      background: var(--bg-card); 
      border-radius: 10px; 
      padding: 15px;
      width: 100%; 
      max-width: 360px; 
      margin-bottom: 20px;
      display: flex; 
      align-items: center;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .input-box input {
      flex: 1; 
      background: transparent; 
      border: none; 
      color: var(--text-primary);
      font-size: 16px; 
      outline: none;
    }
    
    .input-box input::placeholder { 
      color: var(--text-muted); 
    }
    
    .user-list {
      width: 100%; 
      max-width: 360px;
      display: flex; 
      flex-direction: column; 
      gap: 15px; 
      margin-bottom: 30px;
    }
    
    .delete-btn {
      margin-left: auto; 
      background-color: transparent; 
      border: none;
      color: #ff5e5e; 
      font-size: 18px; 
      cursor: pointer; 
      padding: 8px; 
      border-radius: 50%;
      transition: background 0.2s, color 0.2s;
    }
    
    .delete-btn:hover { 
      background: rgba(255,94,94,0.2); 
      color: #ff1c1c; 
    }
    
    .user-card {
      background: var(--bg-card); 
      padding: 12px; 
      border-radius: 10px;
      display: flex; 
      align-items: center; 
      gap: 12px; 
      cursor: pointer;
      border: 1px solid var(--border);
      box-shadow: 0 2px 8px var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .user-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow);
    }
    
    .user-card img {
      width: 50px; 
      height: 50px; 
      border-radius: 50%;
      object-fit: cover; 
      border: 2px solid var(--accent);
    }
    
    .user-info { 
      text-align: left; 
      flex: 1;
    }
    
    .user-info strong { 
      display: block; 
      font-size: 15px;
      color: var(--text-primary);
    }
    
    .user-info small {
      color: var(--text-secondary);
      font-size: 13px;
    }
    
    .login-btn {
      background-color: var(--accent); 
      color: white;
      width: 100%; 
      max-width: 360px; 
      padding: 14px;
      border: none; 
      border-radius: 30px; 
      font-size: 16px; 
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .login-btn:hover {
      background-color: var(--accent-secondary);
    }
    
    h3 {
      margin: 30px 0 10px; 
      font-weight: normal; 
      font-size: 15px;
      color: var(--text-primary);
    }
    
    .footer { 
      margin-top: auto; 
      text-align: center; 
      font-size: 12px; 
      color: var(--text-muted); 
    }
    
    .footer b { 
      color: var(--text-primary); 
    }
    
    .footer a { 
      color: var(--accent); 
      text-decoration: underline; 
    }
  </style>
  
  <!-- Theme Management System -->
  <script>
  const ThemeManager = {
    init() {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      this.applyTheme(savedTheme);
      
      // Set initial toggle state if toggle exists on page
      const darkModeToggle = document.getElementById('darkMode');
      if (darkModeToggle) {
        darkModeToggle.checked = savedTheme === 'dark';
      }
    },
    
    applyTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light');
      } else {
        document.body.classList.remove('light');
      }
      localStorage.setItem('theme', theme);
    },
    
    toggle() {
      const currentTheme = document.body.classList.contains('light') ? 'light' : 'dark';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      this.applyTheme(newTheme);
      
      // Update toggle state if it exists
      const darkModeToggle = document.getElementById('darkMode');
      if (darkModeToggle) {
        darkModeToggle.checked = newTheme === 'dark';
      }
    }
  };
  
  // Initialize theme on page load
  document.addEventListener('DOMContentLoaded', () => {
    ThemeManager.init();
  });
  </script>
</head>
<body>
  <div class="logo">
    <img src="kudirat-logo.png" alt="Kudirat Logo">
  </div>
  <h2>Select an Account</h2>
  <div class="input-box">
    <input id="newPhone" type="text" placeholder="Enter your Mobile No./Email" />
  </div>
  <button onclick="continueLogin()" class="login-btn">Continue</button>
  <h3>Previous Users</h3>
  <div class="user-list" id="userList"></div>
  <div class="footer">
    Don't have a Kudirat Wallet Account yet?<br/>
    <a href="register.html">Click here to get one</a><br/><br/>
    <span>Licensed by the <b>CBN</b> and insured by the <b>NDIC</b></span>
  </div>
  
  <script>
    const userList = document.getElementById("userList");
    const users = JSON.parse(localStorage.getItem("kudiratUsers")) || [];
    
    // Function to mask phone number
    function maskPhoneNumber(phone) {
      if (!phone) return "";
      
      // Handle international format (+234...)
      if (phone.startsWith('+')) {
        return phone.substring(0, 4) + '******' + phone.substring(phone.length - 2);
      }
      
      // Handle local format (0...)
      if (phone.startsWith('0')) {
        return phone.substring(0, 3) + '******' + phone.substring(phone.length - 2);
      }
      
      // Default masking for other formats
      return phone.substring(0, 2) + '******' + phone.substring(phone.length - 2);
    }
    
    function selectUser(contact) {
      localStorage.setItem("currentUserPhone", contact);
      window.location.href = "login.html"; // Go straight to login without alerts
    }
    
    function renderUsers() {
      userList.innerHTML = "";
      if (!users.length) return; // No previous users â€” nothing to show
      
      users.forEach((user, index) => {
        const avatarSrc = user.avatar?.trim()
          ? user.avatar
          : `https://i.pravatar.cc/150?u=${user.number || user.accountNumber || index}`;
        
        // Use the phone number for display (masked)
        const displayContact = user.number || "";
        const maskedContact = user.number ? maskPhoneNumber(user.number) : "";
        
        // Format the account creation date
        const createdDate = user.createdAt ? new Date(user.createdAt) : null;
        const formattedDate = createdDate ? 
          `Account created: ${createdDate.toLocaleDateString()}` : 
          "Account created: Unknown";
        
        const card = document.createElement("div");
        card.className = "user-card";
        card.innerHTML = `
          <img src="${avatarSrc}" alt="avatar" />
          <div class="user-info">
            <strong>${maskedContact}</strong>
            <small>${formattedDate}</small>
          </div>
          <button class="delete-btn" title="Remove User">
            <i class="fas fa-trash-alt"></i>
          </button>
        `;
        
        // Click to select user
        card.addEventListener("click", (e) => {
          if (!e.target.closest(".delete-btn") && displayContact) {
            selectUser(displayContact);
          }
        });
        
        // Delete user from list
        card.querySelector(".delete-btn").onclick = (e) => {
          e.stopPropagation();
          users.splice(index, 1);
          localStorage.setItem("kudiratUsers", JSON.stringify(users));
          renderUsers();
        };
        
        userList.appendChild(card);
      });
    }
    
    function continueLogin() {
      const phoneOrEmail = document.getElementById("newPhone").value.trim();
      if (!phoneOrEmail) return;
      
      // Check if the input is a phone number (with or without country code)
      let searchPhone = phoneOrEmail;
      if (phoneOrEmail.startsWith('0')) {
        // Convert local format (070...) to international format (+23470...)
        searchPhone = '+234' + phoneOrEmail.substring(1);
      } else if (phoneOrEmail.startsWith('+234')) {
        // Already in international format
        searchPhone = phoneOrEmail;
      }
      
      const user = users.find(u => u.number === searchPhone);
      
      if (user) {
        selectUser(user.number);
      } else {
        window.location.href = "register.html"; // Go straight to register if not found
      }
    }
    
    // Initialize theme and render users when DOM is loaded
    document.addEventListener("DOMContentLoaded", () => {
      ThemeManager.init();
      renderUsers();
    });
  </script>
</body>
</html>