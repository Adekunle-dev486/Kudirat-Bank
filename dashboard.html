<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kudirat Wallet Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <style>
    /* ... [unchanged CSS from your code] ... */

    @keyframes fadeEye {
      0% { transform: scale(1); opacity: 0.2; }
      50% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background-color: #0e0e0e;
      color: white;
      font-family: "Segoe UI", sans-serif;
    }

    .container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 56px;
      overflow-y: auto;
      padding: 12px;
      box-sizing: border-box;
      z-index: 1;
    }

    .top-section {
      position: sticky;
      top: 0;
      z-index: 2;
      background-color: #1f1f1f;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .top-section h2 {
      margin: 0;
      font-size: 0.95rem;
    }

    .transaction-link {
      color: #00ffae;
      text-decoration: none;
      font-size: 0.85rem;
    }

    .balance-card {
      background-color: #0bb86b;
      padding: 12px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .balance-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .balance-card span {
      font-size: 1.1rem;
      font-weight: bold;
    }

    .action-row, .service-grid {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .action-btn, .service-btn {
      background-color: #1e1e1e;
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      width: 30%;
      margin-bottom: 10px;
      cursor: pointer;
      color: white;
      text-decoration: none;
      font-size: 0.85rem;
    }

    .action-btn:hover, .service-btn:hover {
      background-color: #333;
    }

    .alert-card, .bonus-card {
      background-color: #2e2e2e;
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .bonus-card a {
      color: #00ffae;
      text-decoration: none;
      font-weight: bold;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: #111;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      border-top: 1px solid #222;
      z-index: 3;
    }

    .bottom-nav a {
      color: white;
      text-align: center;
      text-decoration: none;
      font-size: 0.85rem;
    }

    .icon {
      font-size: 1rem;
      display: block;
      margin-bottom: 2px;
    }

    .eye-icon {
      background: none;
      border: none;
      color: white;
      font-size: 1.1rem;
      cursor: pointer;
    }

    #cardPopup {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    #cardPopup .popup-content {
      background: #1f1f1f;
      padding: 16px;
      border-radius: 10px;
      width: 90%;
      max-width: 350px;
      color: white;
    }

    #cardPopup input {
      margin: 6px 0;
      width: 100%;
      padding: 10px;
      background: #333;
      color: white;
      border: none;
      border-radius: 6px;
    }

    #cardPopup .input-row {
      display: flex;
      gap: 8px;
    }

    #cardPopup button {
      width: 100%;
      padding: 10px;
      background-color: #00b86b;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 15px;
      margin-top: 8px;
    }

    #cardPopup .cancel-btn {
      background: none;
      color: #aaa;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <script>
    if (!localStorage.getItem("kudiratUser")) {
      window.location.href = "login.html";
    }
  </script>

  <div class="top-section">
    <div style="display: flex; align-items: center; gap: 10px;">
      <a href="profile.html">
        <img id="profilePic" src="default-avatar.png" alt="Avatar"
          style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid #00ffae;" />
      </a>
      <h2>Hi, <span id="username">User</span></h2>
    </div>
  </div>

  <div class="balance-card">
    <div class="balance-info">
      <span id="balance">****</span>
      <button class="eye-icon" onclick="toggleBalance()" id="eyeBtn"><i class="far fa-eye"></i></button>
    </div>
    <div style="display: flex; flex-direction: column; align-items: flex-end;">
      <a href="./transaction.html" class="transaction-link" style="margin-bottom: 6px;">ðŸ“„ Transactions</a>
      <button onclick="openCardForm()" style="background:black;border:solid black;border-radius: 10px; text-decoration:none;color:white;font-size:1rem;cursor:pointer;">+ Add Money</button>
    </div>
  </div>

  <!-- Action buttons -->
  <div class="action-row">
    <a href="./To-kudirat.html" class="action-btn">To Kudirat</a>
    <a href="#" class="action-btn">To Bank</a>
    <a href="#" class="action-btn">Withdraw</a>
  </div>

  <!-- Alert -->
  <div class="alert-card">
    <strong>Your BVN and NIN info do not match</strong><br />
    <small>Click to view more details</small>
  </div>

  <!-- Service grid -->
  <div class="service-grid">
    <a href="airtime.html" class="service-btn"><i class="fas fa-phone"></i> Airtime</a>
    <a href="data.html" class="service-btn"><i class="fas fa-wifi"></i> Data</a>
    <a href="betting.html" class="service-btn"><i class="fas fa-futbol"></i> Betting</a>
    <a href="tv.html" class="service-btn"><i class="fas fa-tv"></i> TV</a>
    <a href="safebox.html" class="service-btn"><i class="fas fa-lock"></i> Safebox</a>
    <a href="loan.html" class="service-btn"><i class="fas fa-hand-holding-usd"></i> Loan</a>
    <a href="invitation.html" class="service-btn"><i class="fas fa-user-friends"></i> Invitation</a>
    <a href="more.html" class="service-btn"><i class="fas fa-ellipsis-h"></i> More</a>
  </div>

  <!-- Bonus -->
  <div class="bonus-card">
    <strong>Cash up for grabs!</strong><br />
    <small>Invite friends, earn up to â‚¦6,300 Bonus</small><br />
    <a href="referral.html">Click here to refer friends</a>
  </div>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <a href="#"><span class="icon"><i class="fas fa-home"></i></span>Home</a>
    <a href="#"><span class="icon"><i class="fas fa-gift"></i></span>Rewards</a>
    <a href="#"><span class="icon"><i class="fas fa-wallet"></i></span>Finance</a>
    <a href="#"><span class="icon"><i class="fas fa-credit-card"></i></span>Cards</a>
    <a href="#" onclick="logout()"><span class="icon"><i class="fas fa-sign-out-alt"></i></span>Logout</a>
  </div>

  <!-- Card Funding Popup -->
  <div id="cardPopup">
    <div class="popup-content">
      <h3 style="text-align:center;">Fund Wallet with Card</h3>
      <input id="cardName" type="text" placeholder="Cardholder Name">
      <input id="cardNumber" type="text" placeholder="Card Number" maxlength="16">
      <div class="input-row">
        <input id="expiry" type="text" placeholder="MM/YY" maxlength="5">
        <input id="cvv" type="text" placeholder="CVV" maxlength="3">
      </div>
      <input id="fundAmount" type="number" placeholder="Enter Amount">
      <button onclick="fundWallet()">Pay</button>
      <button onclick="closeCardForm()" class="cancel-btn">Cancel</button>
    </div>
  </div>

  <script>
    let isHidden = true;
    const firstName = localStorage.getItem("firstName") || "User";
    document.getElementById("username").textContent = firstName;

    // Show saved profile image or fallback
    const profilePic = document.getElementById("profilePic");
    const storedProfile = localStorage.getItem("photo");
    profilePic.src = storedProfile && storedProfile.trim() !== ""
      ? storedProfile
      : "https://i.pravatar.cc/150?img=3";

    function toggleBalance() {
      const balance = document.getElementById("balance");
      const eyeBtn = document.getElementById("eyeBtn");
      const storedBalance = localStorage.getItem("walletBalance") || "0.00";
      if (isHidden) {
        balance.textContent = `â‚¦${parseFloat(storedBalance).toFixed(2)}`;
        eyeBtn.innerHTML = '<i class="far fa-eye-slash" style="animation: fadeEye 0.3s ease;"></i>';
      } else {
        balance.textContent = "****";
        eyeBtn.innerHTML = '<i class="fas fa-eye" style="animation: fadeEye 0.3s ease;"></i>';
      }
      isHidden = !isHidden;
    }

    function openCardForm() {
      document.getElementById("cardPopup").style.display = "flex";
    }

    function closeCardForm() {
      document.getElementById("cardPopup").style.display = "none";
    }

    function fundWallet() {
      const name = document.getElementById("cardName").value.trim();
      const number = document.getElementById("cardNumber").value.trim();
      const expiry = document.getElementById("expiry").value.trim();
      const cvv = document.getElementById("cvv").value.trim();
      const amount = parseFloat(document.getElementById("fundAmount").value);

      if (!name || number.length !== 16 || expiry.length !== 5 || cvv.length !== 3 || isNaN(amount) || amount <= 0) {
        alert("Please fill all card fields correctly.");
        return;
      }

      setTimeout(() => {
        let current = parseFloat(localStorage.getItem("walletBalance") || "0.00");
        let newBalance = current + amount;
        localStorage.setItem("walletBalance", newBalance.toFixed(2));

        const transactions = JSON.parse(localStorage.getItem("kudiratTransactions")) || [];
        transactions.push({
          type: "credit",
          amount: amount,
          date: new Date().toLocaleString(),
          description: "Wallet Funded via Card",
          from: firstName
        });
        localStorage.setItem("kudiratTransactions", JSON.stringify(transactions));

        if (!isHidden) {
          document.getElementById("balance").textContent = `â‚¦${newBalance.toFixed(2)}`;
        }

        alert(`â‚¦${amount.toFixed(2)} added successfully to your wallet.`);
        closeCardForm();
      }, 1000);
    }

    function logout() {
      localStorage.removeItem("kudiratUser");
      localStorage.removeItem("walletBalance");
      localStorage.removeItem("sessionToken");
      window.location.href = "login.html";
    }
  </script>
</body>
